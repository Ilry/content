-- 一个针对单人模式的延迟优化工具
-- 
-- [基本原理]
--  
-- 1. 饥荒联机版的延迟来源于玩家和服务器的网络通讯.
--
-- 2. 游客和房主[host]之间一定存在延迟; 房主与自己服务器本身可能存在延迟, 这取决于洞穴:
-- 	* 关闭洞穴时, 只有1个世界, 房主一直在线, 可作为主机[server], 此时无延迟
-- 	* 开启洞穴时, 有上下2个世界, 房主不会一直在线, 需要有上下洞穴的操作 (在这段时间, 房主可视为离线)
-- 	  因此, 即使是房主也无法作为主机[server], 必须以客户端的形式和本地主机连接, 此时有延迟
-- 	* 注: 有些人可能把洞穴档的延迟归功于「同时运行2个世界带来的性能负担」, 这是一个误区.
-- 	      实际上, 不管电脑性能有多强, 在运行洞穴档时都会产生网络延迟.
-- 	     
-- 3. 饥荒联机版网络通讯频率为15次/秒, 两次通讯的间隔时间高达66毫秒,
--    这意味着即便是本地连接, 也会因为这段通讯间隔导致延迟.
--    具体体现为: 当玩家发出某个指令 (比如从怪物身边跑开), 指令必须等待下一次网络通讯, 才能发送到服务器, 触发实际的角色动作.
--    这就是为什么在洞穴档走位打怪会比无洞穴档困难.
-- 
-- 4. [独行长路]将洞穴档优化为单个世界运行, 从而使房主直接以主机身份进行游戏, 不需要建立网络连接.
--    * 消除延迟的关键在于使玩家成为主机, 而不是关闭1个世界所带来的性能优化.
--    * 不过, 性能优化也是该mod的一个小小的副效果.
--    * 消除延迟 ≠ 提高帧率, 游戏运行帧率取决于当前的游戏负载和电脑配置, 而延迟取决于玩家和服务器的通讯时间.
--
-- 5. [独行长路]专门针对单人模式优化, 并不支持多人游戏, 这是因为:
--    * 游客和房主之间的延迟是不可避免的, 两台电脑必须通过网络进行交流.
--    * 在房主上下洞穴时, 服务器会暂停, 此时如果有其他玩家在世界中, 他们将无法进行游戏.
-- 
-- 6. 本mod的设计思路来源于饥荒单机版的洞穴/火山机制.
--
-- 
-- [运行细节]
-- 1. 开服
--    * 检查世界设定, 判断是否需要启用单人优化
--    * 启动 master 和 cave 进程, 生成地图, 创建存档
--    * 监听进程信号, 创建成功后直接kill
--    * 将洞穴 session 文件移动到 master（重要！）
--    * 以房主身份开启 master
--    
--    * 如果不是新存档, 则只复制文件, 不生成新地图
--   
-- 2. 读档
--    * 检查玩家位置在 master 还是 cave
--    * 在启动时读取对应位置的 worldsave 和 usersave
--    
-- 3. 存档
--    * 检查目前世界是 master 还是 cave
--      - master: 常规保存
--      - cave: 由于官方 API 的限制, session 会保存在 master 内, 使用 json 文件记录这一次保存位置
-- 
-- 4. 跨世界
--    * 保存当前世界
--    * 修改世界位置、玩家位置, 保存世界运行时间和玩家id
--    * 重新读档
--    
-- 5. 重置世界
--    * 销毁洞穴和地面, 将世界位置设为 cave
--    * 重新读档
--    * 在读档阶段主动检查存档空位, 生成新世界, 先生成 cave, 再生成 master
-- 
-- >> 回滚
--    * 将 master 和 cave 镜像根据运行时间排序
--    * 删除最新的一个/数个镜像, 并设置世界位置和玩家位置
--    * 重新读档
--  
--    
-- [已知bug]
-- >> 在继承旧存档时，洞穴id似乎会被打乱
-- >> 云存档缓存机制引起的内容拷贝
-- >> 大厨？
-- >> 继续测试老奶奶的怀表
-- 
-- >> 疯猪刷新机制