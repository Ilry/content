GLOBAL.setmetatable( env,{__index=function(t,k) return GLOBAL.rawget(GLOBAL,k) end}) PrefabFiles={"refine_chest",} Assets={Asset("ATLAS","images/inventoryimages/refine_chest.xml"),Asset("IMAGE","images/inventoryimages/refine_chest.tex"),Asset("ATLAS","minimap/refine_chest_map_icon.xml"),Asset("IMAGE","minimap/refine_chest_map_icon.tex"),Asset("ANIM","anim/refine_chest.zip"),Asset("ANIM","anim/ui_chest_3x3.zip"),Asset("ANIM","anim/ui_chest_5x5.zip"),} AddMinimapAtlas("minimap/refine_chest_map_icon.xml") local LANGUAGE=GetModConfigData("language") GLOBAL.REFINE_PUNISHCOST=GetModConfigData("refine_punishcost") GLOBAL.REFINE_WAIT=GetModConfigData("refine_wait") GLOBAL.REFINE_CHARACTER=GetModConfigData("refine_character") GLOBAL.REFINE_TOOL=GetModConfigData("refine_tool") GLOBAL.REFINE_LIGHT=GetModConfigData("refine_light") GLOBAL.REFINE_LIFE=GetModConfigData("refine_life") GLOBAL.REFINE_FOOD=GetModConfigData("refine_food") GLOBAL.REFINE_TECH=GetModConfigData("refine_tech") GLOBAL.REFINE_WEAPON=GetModConfigData("refine_weapon") GLOBAL.REFINE_BUILD=GetModConfigData("refine_build") GLOBAL.REFINE_SHIP=GetModConfigData("refine_ship") GLOBAL.REFINE_REFINE=GetModConfigData("refine_refine") GLOBAL.REFINE_MAGIC=GetModConfigData("refine_magic") GLOBAL.REFINE_CLOTHING=GetModConfigData("refine_clothing") GLOBAL.REFINE_ANCIENT=GetModConfigData("refine_ancient") GLOBAL.REFINE_MOON=GetModConfigData("refine_moon") GLOBAL.REFINE_TECH_DISTANCE=GetModConfigData("refine_tech_distance") GLOBAL.REFINE_ONLYONESTEP=GetModConfigData("refine_onlyonestep") GLOBAL.REFINE_NOTECHNEED=GetModConfigData("refine_notechneed") GLOBAL.REFINE_NEEDTEMPLATE=GetModConfigData("refine_needtemplate") GLOBAL.REFINE_CHEST_CANSHOWSTR=GetModConfigData("refine_chest_canshowstr") GLOBAL.REFINE_WITH_SKIN=GetModConfigData("refine_with_skin") GLOBAL.REFINE_BY_MINISIGN=GetModConfigData("refine_by_minisign") local containers=require "containers" local params={} local function Make3x3Chest() local chest={widget={slotpos={},animbank="ui_chest_3x3",animbuild="ui_chest_3x3",pos=GLOBAL.Vector3(0,200,0),side_align_tip=160},type="chest"} for y=2,0,-1 do for x=0,2 do table.insert(chest.widget.slotpos,GLOBAL.Vector3(80 * x - 80 * 2 + 80,80 * y - 80 * 2 + 80,0)) end end return chest end local function Make5x5Chest() local chest={widget={slotpos={},animbank="ui_largechest_5x5",animbuild="ui_largechest_5x5",pos=GLOBAL.Vector3(-50,200,0),side_align_tip=160},type="chest"} for y=3,-1,-1 do for x=-1,3 do table.insert(chest.widget.slotpos,GLOBAL.Vector3(80 * x - 80 * 2 + 80,80 * y - 80 * 2 + 80,0)) end end return chest end local old_containers_widgetsetup=containers.widgetsetup function containers.widgetsetup(container,prefab,data,...) local t=params[prefab or container.inst.prefab] if t~=nil then for k,v in pairs(t) do container[k]=v end container:SetNumSlots(container.widget.slotpos~=nil and #container.widget.slotpos or 0) else old_containers_widgetsetup(container,prefab,data,...) end end if GetModConfigData("refine_chest_size")==3 then params.refine_chest=Make3x3Chest() else params.refine_chest=Make5x5Chest() end AddRecipe2( "refine_chest",{Ingredient("boards",3),Ingredient("petals",6)},TECH.SCIENCE_ONE,{placer="refine_chest_placer",atlas="images/inventoryimages/refine_chest.xml",image="refine_chest.tex",},{"REFINE","MODS"}) if LANGUAGE==2 then STRINGS.NAMES.REFINE_CHEST="精炼宝箱" STRINGS.RECIPE_DESC.REFINE_CHEST="适用于大量合成" STRINGS.CHARACTERS.GENERIC.DESCRIBE.REFINE_CHEST="神奇的宝箱󰀏" else STRINGS.NAMES.REFINE_CHEST="Refine Chest" STRINGS.RECIPE_DESC.REFINE_CHEST="Suitable for mass synthesis" STRINGS.CHARACTERS.GENERIC.DESCRIBE.REFINE_CHEST="Magical treasure chest󰀏" end if LANGUAGE==2 then STRINGS.REFINE_CHEST_ERRGAMEID="警告：这不是联机版󰀀" STRINGS.REFINE_CHEST_DOREFINE="精炼完成󰀫" STRINGS.REFINE_CHEST_NOREFINE="什么都没发生" STRINGS.REFINE_CHEST_NEEDMORETECH1="需要更多科技:󰀔" STRINGS.REFINE_CHEST_NEEDMORETECH2="需要更多科技:󰀝" STRINGS.REFINE_CHEST_NEEDMORETECH3="需要更多魔法:󰀖" STRINGS.REFINE_CHEST_NEEDMORETECH4="需要更多魔法:󰀩" STRINGS.REFINE_CHEST_NEEDMORETECH13="需要放入天体宝球" STRINGS.REFINE_CHEST_NEEDMORETECH5="需要更多科技：智囊团" STRINGS.REFINE_CHEST_NEEDMORETECH11="需要更多科技：远古祭坛" STRINGS.REFINE_CHEST_BUT="但" STRINGS.REFINE_CHEST_WALTER="沃尔特需要在精炼宝箱中放置一个对应的子弹󰀏" STRINGS.REFINE_CHEST_WARLY="沃利需要在附近摆放便携研磨器󰀏" STRINGS.REFINE_CHEST_NEEDTEMPLATE="可能需要一个模板" else STRINGS.REFINE_CHEST_ERRGAMEID="Warning : This is not DTS version󰀀" STRINGS.REFINE_CHEST_DOREFINE="Refining completed󰀫" STRINGS.REFINE_CHEST_NOREFINE="Nothing happen" STRINGS.REFINE_CHEST_NEEDMORETECH1="need more tech :󰀔" STRINGS.REFINE_CHEST_NEEDMORETECH2="need more tech :󰀝" STRINGS.REFINE_CHEST_NEEDMORETECH3="need more magic :󰀖" STRINGS.REFINE_CHEST_NEEDMORETECH4="need more magic :󰀩" STRINGS.REFINE_CHEST_NEEDMORETECH13="need put Celestial Orb in this chest" STRINGS.REFINE_CHEST_NEEDMORETECH5="need more tech : Think Tank" STRINGS.REFINE_CHEST_NEEDMORETECH11="need more tech : Ancient Station" STRINGS.REFINE_CHEST_BUT="But " STRINGS.REFINE_CHEST_WALTER="Walter needs to put a corresponding bullet in Refine Chest󰀏" STRINGS.REFINE_CHEST_WARLY="Warly needs a protable seasoning station nearby󰀏" STRINGS.REFINE_CHEST_NEEDTEMPLATE="may need template in this chest" end for _,v in pairs(params) do containers.MAXITEMSLOTS=math.max(containers.MAXITEMSLOTS,v.widget.slotpos~=nil and #v.widget.slotpos or 0) end